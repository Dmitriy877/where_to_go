# Куда пойти — Москва глазами Артёма

Фронтенд для будущего сайта о самых интересных местах в Москве. Авторский проект Артёма.


## Как запустить

* Скачайте код
* Создайте файл .env со следующими настройками
```
DEBUG=False (True Используется для отладки проекта. Логическое значение, которое включает/выключает режим отладки. Если в вашем приложении возникает исключение, когда значение DEBUG равно True, Django отобразит подробную обратную трассировку, включающую множество метаданных о вашей среде, таких как все текущие настройки Django (из settings.py).)
SECRET_KEY= Ключ Проекта (Секретный ключ для конкретной установки Django. Используется для обеспечения криптографической подписи, и его значение должно быть уникальным и непредсказуемым.)
ALLOWED_HOSTS='127.0.0.1' (указан для запуска на Вашем ПК, но не для размещения в интернете. Список строк, представляющих имена хостов/доменов, которые может обслуживать этот сайт Django. Это мера безопасности для предотвращения атак на заголовки HTTP-хостов, которые возможны даже при многих, казалось бы, безопасных конфигурациях веб-серверов.)
```
* Перейдите в консоли в папку с проектом и установите настроки переменного окружения
```
pip install -r requirements.txt
```
* Зарегестрируйте супервользователя
```
python manage.py createsuperuser
```
* Примените миграции
```
python.manage.py makemigrations
```
```
python manage.py migrate
```
* Запустите сервер
```
python manage.py runserver
```
* Имеется возможность добавляьть места при помощи ссылки на json файл. json файл должен быть типа 
```python
{
    "title": "Генератор Маркса или «Катушка Тесла»",
    "imgs": [
        "https://raw.githubusercontent.com/devmanorg/where-to-go-places/master/media/d3b5cc74cc94c802b51c85542b2f9ad5.jpg",
        "https://raw.githubusercontent.com/devmanorg/where-to-go-places/master/media/b742b82f77028d6a8c9be681cab25a3d.jpg",
        "https://raw.githubusercontent.com/devmanorg/where-to-go-places/master/media/57f990fd24a55324fc1fc541cac41b99.jpg",
        "https://raw.githubusercontent.com/devmanorg/where-to-go-places/master/media/2d5be0d4e83fdde3e8c98f18e0d2e365.jpg",
        "https://raw.githubusercontent.com/devmanorg/where-to-go-places/master/media/d4a8ab43eff1f7e83491610682d13984.jpg",
        "https://raw.githubusercontent.com/devmanorg/where-to-go-places/master/media/7945e1e565530ab6943c40d64f21cfb7.jpg"
    ],
    "description_short": "Место, в котором рождаются искусственные молнии и облака.",
    "description_long": "<p>Внешний вид этого монстроподобного, внушительного комплекса заставляет сердца посетителей биться чаще, а некоторое сходство с катушкой Тесла (на самом деле это генератор Аркадьева-Маркса) влечёт сюда всех любителей научпопа, индастриала и других интересующихся. Для того, чтобы попасть на территорию действующего испытательного стенда ВНИЦ ВЭИ, коим и является это окутанное мифами место, рекомендуется договориться с охраной. Несанкционированное попадание в пределы испытаний может повлечь самые серьёзные последствия!</p>",
    "coordinates": {
        "lng": "36.88324860715219",
        "lat": "55.92555463090268"
    }
}
```
* Команда для добавления места из ссылки на json файл
```
python manage.py json_load (Ссылка на json файл)
```
* Пример команды для добавления локации;
```
python manage.py json_load https://raw.githubusercontent.com/devmanorg/where-to-go-places/refs/heads/master/places/%D0%92%D0%BE%D1%80%D0%BE%D0%B1%D1%8C%D1%91%D0%B2%D1%8B%20%D0%B3%D0%BE%D1%80%D1%8B.json
```

* Откройте проект по адресу `http://127.0.0.1:8000/`
* Перейдите во вкладку admin `http://127.0.0.1:8000/admin/` и заполните базу данных (места и фотографии которые будут отображаться на карте. Менять порядок фотографий можно перетаскивая их верх и вниз).

## Настройки

Внизу справа на странице можно включить отладочный режим логгирования.

Настройки сохраняются в Local Storage браузера и не пропадают после обновления страницы. Чтобы сбросить настройки, удалите ключи из Local Storage с помощью Chrome Dev Tools —&gt; Вкладка Application —&gt; Local Storage.

Если что-то работает не так, как ожидалось, то начните с включения отладочного режима логгирования.

<a href="#" id="data-sources"></a>

## Источники данных

Фронтенд получает данные из json файла, который формируется из базы данных.

При загрузке страницы JS код ищет тег с id `places-geojson`, считывает содержимое и помещает все объекты на карту.

Данные записаны в [формате GeoJSON](https://ru.wikipedia.org/wiki/GeoJSON). Все поля здесь стандартные, кроме `properties`. Внутри `properties` лежат специфичные для проекта данные:

* `title` — название локации
* `placeId` — уникальный идентификатор локации, строка или число
* `detailsUrl` — адрес для скачивания доп. сведений о локации в JSON формате

Значение поля `placeId` может быть либо строкой, либо числом. Само значение не играет большой роли, важно лишь чтобы оно было уникальным. Фронтенд использует `placeId` чтобы избавиться от дубликатов — если у двух локаций одинаковый `placeId`, то значит это одно и то же место.

Второй источник данных — это те самые адреса в поле `detailsUrl` c подробными сведениями о локации. Каждый раз, когда пользователь выбирает локацию на карте, JS код отправляет запрос на сервер и получает картинки, текст и прочую информацию об объекте. Формат ответа сервера такой:

```javascript
{
    "title": "Экскурсионный проект «Крыши24.рф»",
    "imgs": [
        "https://kudago.com/media/images/place/d0/f6/d0f665a80d1d8d110826ba797569df02.jpg",
        "https://kudago.com/media/images/place/66/23/6623e6c8e93727c9b0bb198972d9e9fa.jpg",
        "https://kudago.com/media/images/place/64/82/64827b20010de8430bfc4fb14e786c19.jpg",
    ],
    "description_short": "Хотите увидеть Москву с высоты птичьего полёта?",
    "description_long": "<p>Проект «Крыши24.рф» проводит экскурсии ...</p>",
    "coordinates": {
        "lat": 55.753676,
        "lng": 37.64
    }
}
```

## Используемые библиотеки фронтенд

* [Leaflet](https://leafletjs.com/) — отрисовка карты
* [loglevel](https://www.npmjs.com/package/loglevel) для логгирования
* [Bootstrap](https://getbootstrap.com/) — CSS библиотека
* [Vue.js](https://ru.vuejs.org/) — реактивные шаблоны на фронтенде

## Используемые библиотеки Бэкенд

* [Django](https://www.djangoproject.com/) — Web Framework
* [envorons](https://pypi.org/project/environs/) - Библиотека Python для анализа переменных окружения.
* [django-admin-sortable2 2.2.8](https://pypi.org/project/django-admin-sortable2/) — Этот пакет Django добавляет функциональность для общего упорядочения элементов в списке перетаскиванием
* [django-tinymce](https://pypi.org/project/django-tinymce/) — это приложение для Django, которое содержит виджет для отображения поля формы в виде редактора TinyMCE.
* [requests](https://pypi.org/project/requests/) — позволяет легко отправлять запросы HTTP/1.1.


## Цели проекта

Код написан в учебных целях — это урок в курсе по Python и веб-разработке на сайте [Devman](https://dvmn.org).


